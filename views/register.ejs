<!-- In register.ejs -->
<!DOCTYPE html>
<html>
<head>
  <title>Register</title>
</head>
<body>
  <h1>Register</h1>
  
  <% if (typeof error !== 'undefined' && error) { %>
    <div style="color: red;"><%= error %></div>
  <% } %>
  
  <!-- Added CSRF token to form -->
  <form method="post" action="/register">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <div>
      <label for="username">Username:</label>
      <input type="text" id="username" name="username" minlength="3" maxlength="20" required
        value="<%= typeof formData !== 'undefined' && formData && formData.username ? formData.username : '' %>"
        pattern="[a-zA-Z0-9_]+" title="Username can only contain letters, numbers, and underscores">
    </div>
    <div>
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required
        value="<%= typeof formData !== 'undefined' && formData && formData.email ? formData.email : '' %>">
    </div>
    <div>
      <label for="password">Password:</label>
      <input type="password" id="password" name="password" minlength="8" required>
      <small>Password must be at least 8 characters</small>
    </div>
    <button type="submit">Register</button>
  </form>
  
  <p>Already have an account? <a href="/login">Login</a></p>
</body>
</html>