<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <script>
    window.onload = function() {
      // DOM-based XSS vulnerability
      const urlParams = new URLSearchParams(window.location.search);
      const theme = urlParams.get('theme');
      
      if (theme) {
        document.getElementById('theme-message').innerHTML = 'Current theme: ' + theme;
        document.getElementById('theme-message').style.display = 'block';
      }
      
      if (window.location.hash) {
        document.getElementById('welcome-banner').innerHTML = 'Welcome back, ' + window.location.hash.substring(1);
      }
    }
  </script>
</head>
<body>
  <h1>Task Manager Dashboard</h1>
  
  <div>
    <a href="/profile">My Profile</a> | 
    <a href="/logout">Logout</a>
  </div>
  
  <div>
    <h3>Welcome, <%= user.username %>!</h3>
    <p>You are logged in as a <%= user.role %>.</p>
  </div>
  
  <div id="welcome-banner"></div>
  <div id="theme-message" style="display: none;"></div>
  
  <!-- User search with SQL injection vulnerability -->
  <div>
    <h3>Search Users</h3>
    <form action="/" method="get">
      <input type="text" name="search" value="<%= searchTerm %>" placeholder="Search by username or email...">
      <button type="submit">Search</button>
    </form>
    
<!-- In your dashboard.ejs file -->
<% if (searchResults && searchResults.length > 0) { %>
  <h4>Search Results:</h4>
  <table border="1">
    <tr>
      <th>ID</th>
      <th>Username</th>
      <th>Email</th>
      <th>Role</th>
    </tr>
    <% searchResults.forEach(user => { %>
      <tr>
        <td><%= user.id %></td>
        <td><%= user.username %></td>
        <td><%= user.email %></td>
        <td><%= user.role %></td>
      </tr>
    <% }); %>
  </table>
<% } else if (searchTerm) { %>
  <p>No users found matching your search.</p>
<% } %>
  </div>
  
  <!-- Status update (Stored XSS vulnerability) -->
  <div style="margin-top: 20px;">
    <h3>Update Your Status</h3>
    <form action="/" method="get">
      <input type="text" name="message" placeholder="What are you working on today?">
      <button type="submit">Update</button>
    </form>
    
    <% if (message) { %>
      <div style="margin-top: 10px; padding: 10px; border: 1px solid #ccc;">
        <strong>Your current status:</strong> <%- message %>
      </div>
    <% } %>
  </div>
  
  <!-- Reflected XSS vulnerability -->
  <% if (typeof reflectedXss !== 'undefined' && reflectedXss) { %>
    <div style="margin-top: 20px; padding: 10px; background-color: #f0f0f0;">
      <strong>Notification:</strong> <%- reflectedXss %>
    </div>
  <% } %>
  
  <% if (user.role === 'admin') { %>
    <div style="margin-top: 30px; padding: 15px; border: 2px solid #333;">
      <h3>Admin Panel</h3>
      <p>Welcome to the admin area. Here you can manage users and system settings.</p>
      
      <div>
        <h4>Quick Links</h4>
        <ul>
          <li><a href="/api/users" target="_blank">View All User Data</a> (API endpoint)</li>
        </ul>
      </div>
    </div>
  <% } %>
</body>
</html>